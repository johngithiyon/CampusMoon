<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="admin.css">
  <title>Admin</title>
</head>
<body>
  <div class="login">
    <h2>Admin</h2>
    <form class="form" id="adminForm">
      <input id="name" type="text" required placeholder="Enter College name"><br>
      <input id="pass" type="password" required placeholder="Enter College Code"><br>  
      <input id="address" type="text" required placeholder="Enter College address"><br>  
      <input id="button" type="submit" value="Login">
    </form>
  </div>

  <script>
    document.getElementById("adminForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      let name = document.getElementById("name").value;
      let code = document.getElementById("pass").value;
      let address = document.getElementById("address").value;

      // simple validations
      let regname = /^[a-zA-Z\s]+$/;
      let passreg = /^[a-zA-Z0-9]{4,}$/; // 4+ chars
      let addrs = /^[a-zA-Z0-9\s,.-]+$/;

      if (!regname.test(name)) {
        alert("Enter a valid name");
        return;
      }
      if (!passreg.test(code)) {
        alert("Enter a valid college code (letters & numbers, min 4 chars)");
        return;
      }
      if (!addrs.test(address)) {
        alert("Enter a proper college address with pincode");
        return;
      }

      try {
        // Send data to Go backend
        let res = await fetch("/admin/register", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name: name, code: code, address: address })
        });

        if (!res.ok) {
          alert("❌ Failed to register admin!");
          return;
        }

        let data = await res.json();

        // ✅ Show IDs first
        alert("✅ Registration Successful!\nStudent ID: " + data.student_id + "\nStaff ID: " + data.staff_id);

        // ✅ Redirect to home page
        window.location.href = "index.html";

      } catch (err) {
        console.error(err);
        alert("Server error, please try again!");
      }
    });
  </script>
</body>
</html>
