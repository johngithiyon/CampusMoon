<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Moon - Educational Assistant</title>
  <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(-45deg, #6a11cb, #2575fc, #0099cc, #4facfe);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            min-height: 100vh;
            color: #fff;
            padding: 20px;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 30px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            font-size: 2.8rem;
            font-weight: 800;
            color: #fff;
            text-shadow: 0 0 15px rgba(255, 204, 0, 0.5);
            display: flex;
            align-items: center;
            letter-spacing: 1px;
        }

        .logo i {
            margin-right: 15px;
            color: #ffcc00;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 8px rgba(255, 204, 0, 0.7));
            animation: glow 2s infinite alternate;
        }

       @keyframes glow {
    from { filter: drop-shadow(0 0 8px rgba(255, 204, 0, 0.7)); }
    to { filter: drop-shadow(0 0 15px rgba(255, 204, 0, 0.9)); }
}
    

        .hero {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeIn 1s ease;
        }

        .hero h1 {
            font-size: 2.4rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            color: #f8f8f8;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.15rem;
            max-width: 650px;
            margin: 0 auto;
            opacity: 0.9;
            line-height: 1.6;
            padding: 0 15px;
        }

        /* Chat container specific styles */
        .chat-section {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-radius: 22px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1.5s ease;
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .section-title {
            font-size: 1.9rem;
            margin-bottom: 25px;
            padding-bottom: 12px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            display: inline-block;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
            font-weight: 600;
        }

        .chat-container {
            width: 100%;
            height: 480px; /* Fixed height */
            display: flex;
            flex-direction: column;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 18px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .messages {
            flex: 1; /* Takes up all available space */
            padding: 25px;
            overflow-y: scroll; /* Changed to scroll to always show scrollbar */
            display: flex;
            flex-direction: column;
            gap: 18px;
            min-height: 0; /* Crucial for proper flexbox scrolling */
            /* Scrollbar styling */
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.7) rgba(255, 255, 255, 0.2);
        }

        .messages::-webkit-scrollbar {
            width: 14px; /* Increased scrollbar width */
        }

        .messages::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2); /* Darker track for contrast */
            border-radius: 10px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.8); /* More opaque thumb */
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .messages::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .msg {
            margin: 5px 0;
            padding: 14px 20px;
            border-radius: 18px;
            max-width: 78%;
            word-wrap: break-word;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
            animation: fadeIn 0.3s ease;
            line-height: 1.5;
            position: relative;
        }

        .user { 
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
            color: white;
        }

        .bot { 
    background: rgba(255, 255, 255, 0.95);
    align-self: flex-start;
    border-bottom-left-radius: 5px;
    color: #333;
}

        .msg-time {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 6px;
            display: block;
        }

        .audio-control {
            margin-top: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            color: #666;
        }

        .audio-control button {
            background: none;
            border: none;
            color: #4facfe;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-right: 10px;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .audio-control button:hover {
            text-decoration: underline;
            transform: scale(1.05);
        }

        .input-area {
            display: flex;
            padding: 18px;
            background: rgba(255, 255, 255, 0.15);
            gap: 12px;
            align-items: center;
        }

        .input-area input, .input-area select {
            flex: 1;
            padding: 14px 18px;
            border: none;
            border-radius: 50px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .input-area input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .input-area input:focus, .input-area select:focus {
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        .input-area select {
            flex: 0.7;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 15px;
            padding-right: 40px;
            cursor: pointer;
        }

        /* Fix for dropdown options visibility */
        .input-area select option {
            background: rgba(40, 40, 70, 0.95);
            color: white;
            padding: 10px;
            border: none;
        }

        .input-area button {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            border: none;
            color: white;
            padding: 14px 28px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            flex-shrink: 0;
        }

        .input-area button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        .voice-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
        }

        .voice-btn {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .voice-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .voice-btn.recording {
            background: rgba(255, 107, 107, 0.3);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.7); }
            70% { box-shadow: 0 0 0 12px rgba(255, 107, 107, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
        }

        footer {
            text-align: center;
            padding: 25px;
            margin-top: 40px;
            color: rgba(255, 255, 255, 0.7);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Typing indicator */
        .typing-indicator {
            display: inline-flex;
            align-items: center;
            padding: 10px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #999;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out both;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typingAnimation {
            0%, 80%, 100% { 
                transform: scale(0.8);
                opacity: 0.5;
            }
            40% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Language selector styling */
        .language-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            gap: 10px;
            align-items: center;
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .language-selector label {
            font-weight: 600;
            color: #ffcc00;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
        }

        .language-selector select {
            padding: 10px 20px;
            border-radius: 25px;
            background: linear-gradient(45deg, #1a8cde); /* New gradient color */
            color: #333; /* Dark text for better contrast */
            border: 1px solid rgba(255, 255, 255, 0.3);
            outline: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .language-selector select:hover {
            background: linear-gradient(45deg, #b7baea);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .language-selector select:focus {
            background: linear-gradient(45deg, #bfdbf7);
            box-shadow: 0 0 0 2px rgba(255, 204, 0, 0.5);
        }

        /* Fix for dropdown options visibility */
        .language-selector select option {
            background: linear-gradient(45deg, #ff9a9e, #fad0c4);
            color: #333;
            padding: 10px;
            border: none;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .input-area {
                flex-direction: column;
            }
            
            .input-area select {
                flex: 1;
                width: 100%;
            }
            
            .msg {
                max-width: 85%;
            }
            
            .logo {
                font-size: 2.2rem;
            }
            
            .voice-controls {
                flex-direction: column;
            }
            
            .chat-section {
                padding: 20px;
            }
            
            .messages {
                padding: 15px;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .chat-container {
                height: 400px; /* Slightly smaller on mobile */
            }
            
            .language-selector {
                flex-direction: column;
                padding: 10px;
            }
        }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <i>🌙</i> <span id="title">Campus Moon</span>
      </div>
    </header>
    
    <section class="hero">
      <h1 id="heroTitle">Your Academic Companion</h1>
      <p id="heroDescription">Campus Moon helps you navigate your educational journey with multilingual support, speech recognition, and text-to-speech capabilities.</p>
    </section>
    
    <!-- Language Selector -->
    <div class="language-selector">
      <label id="selectLabel">Select Language:</label>
      <select id="language">
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="ta">Tamil</option>
        <option value="rj">Rajasthani</option>
      </select>
    </div>
    
    <section class="chat-section">
      <h2 class="section-title" id="chatTitle">Chat with Campus Moon</h2>
      <div class="chat-container">
        <div class="messages" id="messages"></div>
        <div class="input-area">
          <select id="subject">
            <option value="AI">AI</option>
            <option value="VLSI">VLSI</option>
            <option value="Renewable Energy">Renewable Energy</option>
          </select>
          <input type="text" id="user_input" placeholder="Type a message or use voice input..." />
          <button id="sendBtn">Send</button>
        </div>
      </div>
      <div class="voice-controls">
        <button class="voice-btn" id="recordBtn">
          <span>🎤</span> <span id="voiceBtnText">Voice Input</span>
        </button>
        <button class="voice-btn" id="repeatBtn">
          <span>🔊</span> <span id="repeatBtnText">Repeat Answer</span>
        </button>
      </div>
    </section>
    
    <footer>
      <p id="footerText">© 2025 Campus Moon - Your Educational Companion. All rights reserved.</p>
    </footer>
  </div>
  
  <script>
    let currentLang = "en";
    let lastBotMessage = "";
    let isRecording = false;
    let mediaRecorder = null;
    let audioChunks = [];
    
    // Language-specific content
    const languageContent = {
        en: {
            title: "Campus Moon",
            heroTitle: "Your Academic Companion",
            heroDescription: "Campus Moon helps you navigate your educational journey with multilingual support, speech recognition, and text-to-speech capabilities.",
            selectLabel: "Select Language:",
            chatTitle: "Chat with Campus Moon",
            askPlaceholder: "Type a message or use voice input...",
            sendButton: "Send",
            voiceButton: "Voice Input",
            repeatButton: "Repeat Answer",
            footerText: "© 2025 Campus Moon - Your Educational Companion. All rights reserved.",
            greeting: "Hello! I'm Campus Moon. Ask me anything about AI, VLSI, or Renewable Energy.",
            subjects: ["AI", "VLSI", "Renewable Energy"]
        },
        hi: {
            title: "कैम्पस मून",
            heroTitle: "आपका शैक्षणिक साथी",
            heroDescription: "कैम्पस मून बहुभाषी समर्थन, स्पीच रिकग्निशन और टेक्स्ट-टू-स्पीच क्षमताओं के साथ आपकी शैक्षणिक यात्रा में आपकी मदद करता है।",
            selectLabel: "भाषा चुनें:",
            chatTitle: "कैम्पस मून के साथ चैट करें",
            askPlaceholder: "मैसेज टाइप करें या वॉइस इनपुट का उपयोग करें...",
            sendButton: "भेजें",
            voiceButton: "वॉइस इनपुट",
            repeatButton: "उत्तर दोहराएं",
            footerText: "© 2025 कैम्पस मून - आपका शैक्षणिक साथी। सर्वाधिकार सुरक्षित।",
            greeting: "नमस्ते! मैं कैम्पस मून हूं। एआई, वीएलएसआई, या नवीकरणीय ऊर्जा के बारे में कुछ भी पूछें।",
            subjects: ["कृत्रिम बुद्धिमत्ता", "वीएलएसआई", "नवीकरणीय ऊर्जा"]
        },
        ta: {
            title: "கேம்பஸ் மூன்",
            heroTitle: "உங்கள் கல்வி துணை",
            heroDescription: "கேம்பஸ் மூன் பலமொழி ஆதரவு, பேச்சு அங்கீகாரம் மற்றும் உரை-ஒலி திறன்களுடன் உங்கள் கல்வி பயணத்தில் உதவுகிறது.",
            selectLabel: "மொழியைத் தேர்ந்தெடுக்கவும்:",
            chatTitle: "கேம்பஸ் மூன் சாட்",
            askPlaceholder: "ஒரு செய்தியை தட்டச்சு செய்யவும் அல்லது குரல் உள்ளீட்டைப் பயன்படுத்தவும்...",
            sendButton: "அனுப்பு",
            voiceButton: "குரல் உள்ளீடு",
            repeatButton: "பதிலை மீண்டும் கூறு",
            footerText: "© 2025 கேம்பஸ் மூன் - உங்கள் கல்வி துணை. அனைத்து உரிமைகளும் பாதுகாக்கப்பட்டவை.",
            greeting: "வணக்கம்! நான் கேம்பஸ் மூன். செயற்கை நுண்ணறிவு, மிகப் பெரிய அளவிலான ஒருங்கிணைப்பு, அல்லது புதுப்பிக்கத்தக்க ஆற்றல் பற்றி எதையும் கேளுங்கள்.",
            subjects: ["செயற்கை நுண்ணறிவு", "மிகப் பெரிய அளவிலான ஒருங்கிணைப்பு", "புதுப்பிக்கத்தக்க ஆற்றல்"]
        },
        rj: {
            title: "कैम्पस चांद",
            heroTitle: "तुहारो शैक्षणिक साथी",
            heroDescription: "कैम्पस चांद बहुभाषी समर्थन, आवाज पहचान और टेक्स्ट-टू-स्पीच क्षमताओं के साथ तुहारी शैक्षणिक यात्रा में मदद करै है।",
            selectLabel: "भाषा चुनो:",
            chatTitle: "कैम्पस चांद संग बातचीत करो",
            askPlaceholder: "संदेश लिखो या आवाज इनपुट का उपयोग करो...",
            sendButton: "भेजो",
            voiceButton: "आवाज इनपुट",
            repeatButton: "जवाब दोहराओ",
            footerText: "© 2025 कैम्पस चांद - तुहारो शैक्षणिक साथी। सर्वाधिकार सुरक्षित।",
            greeting: "राम राम! मैं कैम्पस चांद हूं। AI, VLSI, या नवीकरणीय ऊर्जा के बारे में कुछ भी पूछो।",
            subjects: ["कृत्रिम बुद्धि", "बहुत बड़ो एकीकरण", "नवीकरणीय ऊर्जा"]
        }
    };

    // Function to load UI texts
    function loadUI(lang = "en") {
        const texts = languageContent[lang] || languageContent.en;
        
        // Update all UI elements with the fetched texts
        document.getElementById("title").innerText = texts.title;
        document.title = texts.title + " - Educational Assistant";
        document.getElementById("heroTitle").innerText = texts.heroTitle;
        document.getElementById("heroDescription").innerText = texts.heroDescription;
        document.getElementById("selectLabel").innerText = texts.selectLabel;
        document.getElementById("chatTitle").innerText = texts.chatTitle;
        document.getElementById("user_input").placeholder = texts.askPlaceholder;
        document.getElementById("sendBtn").innerText = texts.sendButton;
        document.getElementById("voiceBtnText").innerText = texts.voiceButton;
        document.getElementById("repeatBtnText").innerText = texts.repeatButton;
        document.getElementById("footerText").innerText = texts.footerText;
        
        // Update subject dropdown
        const subjectSelect = document.getElementById("subject");
        subjectSelect.innerHTML = '';
        texts.subjects.forEach(subject => {
            const option = document.createElement("option");
            option.value = subject;
            option.textContent = subject;
            subjectSelect.appendChild(option);
        });
    }

    // Function to set language
    function setLanguage(lang) {
        currentLang = lang;
        loadUI(lang);
        
        // Notify backend of language change
        fetch('/set_language', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ lang: lang })
        })
        .catch(error => console.error('Error setting language:', error));
        
        // Clear chat and show new greeting
        document.getElementById("messages").innerHTML = "";
        addMessage("bot", languageContent[lang].greeting);
        lastBotMessage = languageContent[lang].greeting;
    }

    // Add message to chat box
    function addMessage(sender, text) {
        const msg = document.createElement("div");
        msg.classList.add(sender === "user" ? "user" : "bot");
        msg.classList.add("msg");

        const now = new Date();
        const timeString = now.toLocaleTimeString([], {
            hour: "2-digit",
            minute: "2-digit",
        });
        msg.innerHTML = text + `<span class="msg-time">${timeString}</span>`;

        // Add audio control for bot messages
        if (sender === "bot") {
            lastBotMessage = text;
            const audioControl = document.createElement("div");
            audioControl.classList.add("audio-control");
            audioControl.innerHTML = `<button onclick="speakText('${encodeURIComponent(text)}')">🔊 ${currentLang === 'en' ? 'Listen' : currentLang === 'hi' ? 'सुनें' : currentLang === 'ta' ? 'கேளுங்கள்' : 'सुणो'}</button>`;
            msg.appendChild(audioControl);
        }

        const chatBox = document.getElementById("messages");
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // Speak text using browser's TTS API
    function speakText(text) {
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(decodeURIComponent(text));
            utterance.lang = currentLang === 'en' ? 'en-US' : 
                            currentLang === 'hi' ? 'hi-IN' : 
                            currentLang === 'ta' ? 'ta-IN' : 'hi-IN';
            speechSynthesis.speak(utterance);
        }
        else {
            // Fallback to server-side TTS
            fetch(`/tts?text=${encodeURIComponent(text)}&lang=${currentLang}`)
                .then(response => response.blob())
                .then(blob => {
                    const audioUrl = URL.createObjectURL(blob);
                    const audio = new Audio(audioUrl);
                    audio.play();
                })
                .catch(error => console.error('Error with TTS:', error));
        }
    }

    // Repeat the last bot message
    function speakLastBotMessage() {
        if (lastBotMessage) {
            speakText(encodeURIComponent(lastBotMessage));
        }
    }

    // Send message to backend
    async function sendMessage() {
        const input = document.getElementById("user_input");
        const subject = document.getElementById("subject").value;

        if (!input.value) return;

        addMessage("user", input.value);
        const userMessage = input.value;
        input.value = "";

        try {
            // Show typing indicator
            const typingIndicator = document.createElement("div");
            typingIndicator.classList.add("bot", "msg");
            typingIndicator.innerHTML = '<div class="typing-indicator"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
            typingIndicator.id = "typing-indicator";
            document.getElementById("messages").appendChild(typingIndicator);

            // Send request to Flask backend
            const response = await fetch('/ask', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    question: userMessage,
                    subject: subject
                })
            });

            // Remove typing indicator
            document.getElementById("typing-indicator").remove();

            if (!response.ok) {
                throw new Error('Network response was not ok');
            }

            const data = await response.json();
            addMessage("bot", data.answer);
            lastBotMessage = data.answer;
        } catch (error) {
            console.error('Error:', error);
            addMessage("bot", "Sorry, I'm having trouble connecting to the server. Please try again later.");
        }
    }

    // Toggle voice recording
    async function toggleRecording() {
        const recordBtn = document.getElementById("recordBtn");
        if (!isRecording) {
            try {
                // For demo purposes, we'll simulate recording
                isRecording = true;
                recordBtn.classList.add("recording");
                recordBtn.innerHTML = `<span>⏹️</span> ${currentLang === 'en' ? 'Stop Recording' : currentLang === 'hi' ? 'रिकॉर्डिंग रोकें' : currentLang === 'ta' ? 'பதிவை நிறுத்து' : 'रिकॉर्डिंग रोको'}`;
                
                // Simulate recording for 3 seconds
                setTimeout(() => {
                    if (isRecording) {
                        isRecording = false;
                        recordBtn.classList.remove("recording");
                        recordBtn.innerHTML = `<span>🎤</span> ${currentLang === 'en' ? 'Voice Input' : currentLang === 'hi' ? 'वॉइस इनपुट' : currentLang === 'ta' ? 'குரல் உள்ளீடு' : 'आवाज इनपुट'}`;
                        
                        // Add a simulated voice message
                        const subject = document.getElementById("subject").value;
                        let message = "";
                        if (currentLang === "en") {
                            message = "Tell me about " + subject;
                        } else if (currentLang === "hi") {
                            message = subject + " के बारे में बताएं";
                        } else if (currentLang === "ta") {
                            message = subject + " பற்றி சொல்லுங்கள்";
                        } else if (currentLang === "rj") {
                            message = subject + " के बारे में बतावो";
                        }
                        
                        addMessage("user", message);
                        // Call sendMessage directly
                        sendMessage();
                    }
                }, 3000);
            } catch (error) {
                console.error("Error accessing microphone:", error);
                addMessage("bot", "Microphone access denied. Please allow microphone access to use voice input.");
                isRecording = false;
                recordBtn.classList.remove("recording");
                recordBtn.innerHTML = `<span>🎤</span> ${currentLang === 'en' ? 'Voice Input' : currentLang === 'hi' ? 'वॉइस इनपुट' : currentLang === 'ta' ? 'குரல் உள்ளீடு' : 'आवाज इनपुट'}`;
            }
        } else {
            // Stop recording
            isRecording = false;
            recordBtn.classList.remove("recording");
            recordBtn.innerHTML = `<span>🎤</span> ${currentLang === 'en' ? 'Voice Input' : currentLang === 'hi' ? 'वॉइस इनपुट' : currentLang === 'ta' ? 'குரல் உள்ளீடு' : 'आवाज इनपुट'}`;
        }
    }

    // Event listeners
    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    document.getElementById("language").addEventListener("change", e => setLanguage(e.target.value));
    document.getElementById("repeatBtn").addEventListener("click", speakLastBotMessage);
    document.getElementById("recordBtn").addEventListener("click", toggleRecording);

    // Allow sending message with Enter key
    document.getElementById("user_input").addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            sendMessage();
        }
    });

    // Initial load
    document.addEventListener('DOMContentLoaded', function() {
        loadUI();
        addMessage("bot", languageContent.en.greeting);
        lastBotMessage = languageContent.en.greeting;
    });
  </script>
</body>
</html>