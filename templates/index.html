<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Campus Moon - Remote Classroom</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
    body {background:linear-gradient(-45deg,#6a11cb,#2575fc,#0099cc,#4facfe);background-size:400% 400%;animation:gradientBG 15s ease infinite;min-height:100vh;color:#fff;padding:20px;}
    @keyframes gradientBG {0%{background-position:0% 50%;}50%{background-position:100% 50%;}100%{background-position:0% 50%;}}
    .container{max-width:1200px;margin:0 auto;}
    header{display:flex;justify-content:space-between;align-items:center;padding:20px 0;margin-bottom:30px;border-bottom:1px solid rgba(255,255,255,0.2);}
    
    /* Updated Logo Styles */
    .logo{font-size:1.8rem;font-weight:700;color:#fff;text-shadow:0 0 10px rgba(0,0,0,0.3);display:flex;align-items:center;}
    .logo i{margin-right:10px;color:#4facfe;} /* Changed color to blue */
    
    .user-actions{display:flex;gap:15px;align-items:center;}
    
    /* Language Selector - Enhanced visibility */
    .language-selector {
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 12px 20px;
      border-radius: 50px;
      color: white;
      cursor: pointer;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
      font-size: 1rem;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .language-selector:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    /* Style the dropdown options */
    .language-selector option {
      background: #2a2a2a;
      color: white;
      padding: 10px;
    }
    
    /* Search Bar Styles */
    .search-container {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }
    .search-container input {
      width: 50%;
      max-width: 500px;
      padding: 12px 20px;
      border-radius: 50px;
      border: none;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 1rem;
      outline: none;
      transition: all 0.3s ease;
    }
    .search-container input::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }
    .search-container button {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 50px;
      margin-left: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .search-container button:hover {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .button-group{display:flex;justify-content:center;gap:25px;margin-bottom:50px;animation:slideUp 1s ease;}
    .btn{padding:18px 35px;font-size:1.1rem;border-radius:12px;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;transition:all 0.3s ease;box-shadow:0 5px 15px rgba(0,0,0,0.2);font-weight:600;}
    .btn-primary{background:linear-gradient(45deg,#ff6b6b,#ff8e8e);color:white;}
    .btn-primary:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(255,107,107,0.4);}
    .btn-secondary{background:linear-gradient(45deg,#4facfe,#00f2fe);color:white;}
    .btn-secondary:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(79,172,254,0.4);}
    .btn-labs{background:linear-gradient(45deg,#9c27b0,#673ab7);color:white;}
    .btn-labs:hover{transform:translateY(-5px);box-shadow:0 10px 20px rgba(156,39,176,0.4);}
    .section-title{font-size:1.8rem;margin-bottom:25px;padding-bottom:10px;border-bottom:2px solid rgba(255,255,255,0.2);display:inline-block;}
    
    /* Subjects Grid Styles */
    .subjects-container{background:rgba(255,255,255,0.1);backdrop-filter:blur(10px);border-radius:20px;padding:30px;margin-bottom:40px;box-shadow:0 10px 30px rgba(0,0,0,0.2);animation:fadeIn 1.5s ease;}
    .subjects-grid{display:grid;grid-template-columns:repeat(3, 1fr);gap:25px;}
    .subject-card{background:rgba(255,255,255,0.08);border-radius:15px;overflow:hidden;transition:all 0.3s ease;box-shadow:0 5px 15px rgba(0,0,0,0.1);position:relative;cursor:pointer;padding:30px;text-align:center;min-height:180px;display:flex;flex-direction:column;justify-content:center;align-items:center;}
    .subject-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,0.2);background:rgba(255,255,255,0.12);}
    .subject-icon{font-size:3rem;margin-bottom:15px;color:#ffcc00;}
    .subject-title{font-size:1.4rem;font-weight:600;margin-bottom:8px;}
    .subject-desc{font-size:0.95rem;color:rgba(255,255,255,0.8);}
    
    /* Subject Page Styles */
    .subject-page{display:none;animation:fadeIn 0.5s ease;}
    .subject-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
    .subject-header h1{font-size:2.5rem;}
    .back-btn{background:rgba(255,255,255,0.1);border:none;padding:10px 20px;border-radius:50px;color:white;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:8px;}
    .back-btn:hover{background:rgba(255,255,255,0.2);}
    
    /* Subject Page Search Bar */
    .subject-search-container {
      display: flex;
      justify-content: center;
      margin: 30px 0;
    }
    .subject-search-container input {
      width: 60%;
      max-width: 600px;
      padding: 15px 25px;
      border-radius: 50px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      color: white;
      font-size: 1.1rem;
      outline: none;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .subject-search-container input::placeholder {
      color: rgba(255, 255, 255, 0.8);
    }
    .subject-search-container input:focus {
      border-color: rgba(255, 255, 255, 0.5);
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    .subject-search-container button {
      background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
      border: none;
      color: white;
      padding: 15px 25px;
      border-radius: 50px;
      margin-left: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1rem;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    .subject-search-container button:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
    }
    
    /* Updated Subject Actions - Small Rectangular Buttons */
    .subject-actions{display:flex;gap:20px;justify-content:center;margin:40px 0;flex-wrap: wrap;}
    .subject-action-btn{background:linear-gradient(45deg,#4facfe,#00f2fe);border:none;padding:12px 25px;border-radius:8px;color:white;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:10px;box-shadow:0 4px 12px rgba(0,0,0,0.2);min-width:180px;justify-content:center;}
    .subject-action-btn:hover{transform:translateY(-3px);box-shadow:0 6px 15px rgba(0,0,0,0.3);}
    .subject-action-btn i{font-size:1.4rem;color:#fff;}
    .subject-action-btn span{font-size:1rem;font-weight:600;text-align:center;}
    
    /* Special styling for chatbot button */
    .subject-action-btn.chatbot{background:linear-gradient(45deg,#9c27b0,#673ab7);}
    .subject-action-btn.chatbot:hover{box-shadow:0 6px 15px rgba(156,39,176,0.4);}
    
    /* Video Gallery Styles */
    .video-gallery{margin-top:40px;}
    .video-gallery h2{font-size:1.8rem;margin-bottom:25px;padding-bottom:10px;border-bottom:2px solid rgba(255,255,255,0.2);display:inline-block;}
    .video-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:25px;}
    .video-card{background:rgba(255,255,255,0.1);border-radius:15px;overflow:hidden;transition:all 0.3s ease;box-shadow:0 5px 15px rgba(0,0,0,0.1);cursor:pointer;}
    .video-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,0.2);}
    .video-thumbnail{width:100%;height:180px;object-fit:cover;background-color:rgba(0,0,0,0.2);}
    .video-info{padding:15px;}
    .video-title{font-size:1.2rem;font-weight:600;margin-bottom:8px;}
    .video-description{font-size:0.9rem;color:rgba(255,255,255,0.8);margin-bottom:10px;}
    .video-actions{display:flex;justify-content:flex-end;}
    .video-delete-btn{background:rgba(255,255,255,0.1);border:none;padding:8px 12px;border-radius:20px;color:white;cursor:pointer;transition:all 0.3s ease;}
    .video-delete-btn:hover{background:rgba(255,0,0,0.3);}
    
    /* Audio Section Styles */
    .audio-section {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      margin-top: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    .audio-section h2 {
      font-size: 1.8rem;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 2px solid rgba(255, 255, 255, 0.2);
      display: inline-block;
    }
    .audio-upload-form {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }
    .audio-upload-form input[type="file"] {
      padding: 10px 15px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      outline: none;
    }
    .audio-upload-form button {
      background: linear-gradient(45deg, #ff9800, #ff5722);
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
    }
    .audio-upload-form button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
    }
    .refresh-audio-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .refresh-audio-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    .audio-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }
    .audio-item {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 15px;
      transition: all 0.3s ease;
    }
    .audio-item:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-3px);
    }
    .audio-item audio {
      width: 100%;
      margin-bottom: 10px;
    }
    
    /* Audio Actions Container - Updated for single button */
    .audio-item .audio-actions {
      display: flex;
      justify-content: center;
      margin-top: 10px;
    }
    .audio-item .convert-text-btn {
      background: linear-gradient(45deg, #8e44ad, #9b59b6);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9rem;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    .audio-item .convert-text-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(142, 68, 173, 0.4);
    }
    
    /* Search results message */
    .search-results-message {
      text-align: center;
      margin: 20px 0;
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.9);
      display: none;
    }
    
    /* Clear search button */
    .clear-search-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      margin-left: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: none;
    }
    .clear-search-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Modal Styles */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:center;align-items:center;}
    .modal-content{background:#222;padding:30px;border-radius:15px;max-width:500px;width:90%;max-height:90vh;overflow-y:auto;}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
    .modal-title{font-size:1.5rem;font-weight:600;}
    .modal-close{background:none;border:none;color:white;font-size:1.5rem;cursor:pointer;}
    .form-group{margin-bottom:20px;}
    .form-group label{display:block;margin-bottom:8px;font-weight:500;}
    .form-group input, .form-group textarea{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:white;font-size:1rem;outline:none;}
    .form-group input:focus, .form-group textarea:focus{border-color:rgba(79,172,254,0.5);background:rgba(255,255,255,0.15);}
    .form-group textarea{resize:vertical;min-height:100px;}
    .file-input-wrapper{position:relative;overflow:hidden;display:inline-block;width:100%;}
    .file-input-wrapper input[type=file]{position:absolute;top:0;right:0;min-width:100%;min-height:100%;font-size:100px;text-align:right;filter:alpha(opacity=0);opacity:0;outline:none;background:white;cursor:inherit;display:block;}
    .file-input-label{display:block;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.1);color:white;text-align:center;cursor:pointer;transition:all 0.3s ease;}
    .file-input-label:hover{background:rgba(255,255,255,0.2);}
    .file-input-label i{margin-right:8px;}
    .form-actions{display:flex;gap:10px;justify-content:flex-end;margin-top:25px;}
    .btn-submit{background:linear-gradient(45deg,#4facfe,#00f2fe);border:none;padding:12px 25px;border-radius:8px;color:white;cursor:pointer;transition:all 0.3s ease;font-weight:600;}
    .btn-submit:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(79,172,254,0.4);}
    .btn-cancel{background:rgba(255,255,255,0.1);border:none;padding:12px 25px;border-radius:8px;color:white;cursor:pointer;transition:all 0.3s ease;}
    .btn-cancel:hover{background:rgba(255,255,255,0.2);}
    .progress-container{margin-top:15px;display:none;}
    .progress-bar{height:8px;background-color:rgba(255,255,255,0.2);border-radius:4px;overflow:hidden;}
    .progress{height:100%;background:linear-gradient(45deg,#4facfe,#00f2fe);width:0%;transition:width 0.3s ease;}
    
    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 2000;
      transform: translateX(120%);
      transition: transform 0.3s ease;
      max-width: 300px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    .notification.success {
      background: linear-gradient(45deg, #4CAF50, #45a049);
    }
    
    .notification.error {
      background: linear-gradient(45deg, #f44336, #d32f2f);
    }
    
    /* Text Modal Styles */
    .text-modal-content {
      background: #222;
      padding: 30px;
      border-radius: 15px;
      max-width: 700px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }
    .text-modal-content h3 {
      margin-bottom: 15px;
      color: #4facfe;
    }
    .text-modal-content p {
      line-height: 1.6;
      margin-bottom: 20px;
      white-space: pre-wrap;
    }
    .text-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    footer{text-align:center;padding:20px;padding-bottom:50px;color:rgba(255,255,255,0.7);border-top:1px solid rgba(255,255,255,0.2);}
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
    @keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
    @media(max-width:992px){.subjects-grid{grid-template-columns:repeat(2, 1fr);}}
    @media(max-width:768px){.button-group{flex-direction:column;align-items:center;}.btn{width:100%;max-width:350px;}.subjects-grid{grid-template-columns:1fr;}header{flex-direction:column;gap:15px;} .search-container input {width: 80%;} .subject-actions{flex-direction:column;align-items:center;} .subject-search-container input{width:80%;} .video-grid{grid-template-columns:1fr;} .audio-list{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo"><i class="fas fa-moon"></i> Campus Moon</div>
      <div class="user-actions">
        <select id="languageSelector" class="language-selector">
          <option value="en">English</option>
          <option value="ta">தமிழ் (Tamil)</option>
          <option value="hi">हिंदी (Hindi)</option>
          <option value="rj">राजस्थानी (Rajasthani)</option>
        </select>
      </div>
    </header>

    <!-- Main Page -->
    <div id="mainPage">
      <!-- Search Bar -->
      <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search subjects..." data-translate-placeholder="search_subjects">
        <button id="searchBtn"><i class="fas fa-search"></i></button>
      </div>

      <div class="button-group">
        <button class="btn btn-primary">
          <a href="http://localhost:8080/meet" style="color:white;text-decoration:none;"><i class="fas fa-video"></i> <span data-translate="live_video">Live Video Stream</span></a>
        </button>
        <button class="btn btn-labs" id="labsBtn">
          <a href="http://localhost:8080/labs" style="color:white;text-decoration:none;"><i class="fas fa-flask"></i> <span data-translate="labs">Labs</span></a>
        </button>
      </div>

      <div class="subjects-container">
        <h2 class="section-title" data-translate="subjects">Subjects</h2>
        <div class="subjects-grid" id="subjectsGrid"></div>
      </div>
    </div>

    <!-- Subject Page -->
    <div id="subjectPage" class="subject-page">
      <div class="subject-header">
        <button class="back-btn" id="backBtn"><i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span></button>
        <h1 id="subjectTitle"></h1>
        <div></div> <!-- Spacer for alignment -->
      </div>

      <!-- Subject Page Search Bar -->
      <div class="subject-search-container">
        <input type="text" id="subjectSearchInput" placeholder="Search in this subject..." data-translate-placeholder="search_subject_content">
        <button id="subjectSearchBtn"><i class="fas fa-search"></i></button>
        <button id="clearSearchBtn" class="clear-search-btn"><i class="fas fa-times"></i></button>
      </div>

      <div id="searchResultsMessage" class="search-results-message"></div>

      <div class="subject-actions">
        <button class="subject-action-btn" id="uploadBtn">
          <i class="fas fa-cloud-upload-alt"></i>
          <span data-translate="upload_videos">Upload Videos</span>
        </button>
        <button class="subject-action-btn chatbot" id="chatbotBtn">
          <i class="fas fa-robot"></i>
          <span data-translate="chatbot">Chatbot</span>
        </button>
      </div>

      <!-- Video Gallery -->
      <div class="video-gallery">
        <h2 data-translate="uploaded_videos">Uploaded Videos</h2>
        <div class="video-grid" id="videoGrid">
          <!-- Videos will be loaded here -->
        </div>
      </div>

      <!-- Audio Section -->
      <div class="audio-section">
        <h2 data-translate="uploaded_audio">Uploaded Audio</h2>
        <form id="audioUploadForm" class="audio-upload-form">
          <input type="file" name="file" accept="audio/*" required />
          <button type="submit">Upload</button>
        </form>
        <button id="refreshAudioList" class="refresh-audio-btn"><i class="fas fa-sync-alt"></i> Refresh List</button>
        <div id="audioList" class="audio-list"></div>
      </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" data-translate="upload_video">Upload Video</h3>
          <button class="modal-close" id="closeModal">&times;</button>
        </div>
        <form id="uploadForm">
          <div class="form-group">
            <label for="videoTitle" data-translate="video_title">Video Title</label>
            <input type="text" id="videoTitle" name="title" required>
          </div>
          <div class="form-group">
            <label for="videoDescription" data-translate="video_description">Video Description</label>
            <textarea id="videoDescription" name="description"></textarea>
          </div>
          <div class="form-group">
            <label data-translate="select_video">Select Video File</label>
            <div class="file-input-wrapper">
              <input type="file" id="videoFile" name="video" accept="video/*" required>
              <label for="videoFile" class="file-input-label">
                <i class="fas fa-file-video"></i>
                <span id="videoFileLabel" data-translate="choose_file">Choose a video file</span>
              </label>
            </div>
          </div>
          <div class="form-group">
            <label data-translate="select_notes">Select Notes File (Optional)</label>
            <div class="file-input-wrapper">
              <input type="file" id="notesFile" name="notes" accept=".pdf,.ppt,.pptx">
              <label for="notesFile" class="file-input-label">
                <i class="fas fa-file-powerpoint"></i>
                <span id="notesFileLabel" data-translate="choose_notes">Choose a notes file</span>
              </label>
            </div>
          </div>
          <!-- Hidden field for subject ID -->
          <div class="form-group" style="display: none;">
            <input type="hidden" id="subjectId" name="subjectId">
          </div>
          <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
              <div class="progress" id="progressBar"></div>
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn-cancel" id="cancelUpload" data-translate="cancel">Cancel</button>
            <button type="submit" class="btn-submit" data-translate="upload">Upload</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Text Modal for displaying converted text -->
    <div id="textModal" class="modal">
      <div class="text-modal-content">
        <div class="modal-header">
          <h3 class="modal-title">Converted Text</h3>
          <button class="modal-close" id="closeTextModal">&times;</button>
        </div>
        <div id="convertedText">
          <!-- Converted text will be displayed here -->
        </div>
        <div class="text-modal-actions">
          <button type="button" class="btn-cancel" id="closeTextModalBtn">Close</button>
          <button type="button" class="btn-submit" id="downloadTextBtn">Download as Text File</button>
        </div>
      </div>
    </div>

    <!-- Notification container -->
    <div id="notification" class="notification"></div>

    <footer><span data-translate="copyright">Campus Moon &copy; 2025</span></footer>
  </div>

  <script>
    // Translation dictionaries
    const translations = {
      en: {
        "live_video": "Live Video Stream",
        "upload_video": "Upload Video",
        "upload_audio": "Upload Audio",
        "labs": "Labs",
        "subjects": "Subjects",
        "video_title": "Video Title",
        "video_description": "Video Description",
        "select_video": "Select Video File",
        "select_notes": "Select Notes File (Optional)",
        "choose_file": "Choose a video file",
        "choose_notes": "Choose a notes file",
        "uploaded_videos": "Uploaded Videos",
        "uploaded_audio": "Uploaded Audio",
        "enter_video_title": "Enter video title",
        "enter_video_description": "Enter video description",
        "upload": "Upload",
        "cancel": "Cancel",
        "copyright": "Campus Moon &copy; 2025",
        "delete": "Delete",
        "uploaded": "Uploaded",
        "search_subjects": "Search subjects...",
        "search_subject_content": "Search in this subject...",
        "back": "Back",
        "upload_videos": "Upload Videos",
        "chatbot": "Chatbot",
        "no_results": "No videos found matching your search.",
        "showing_results": "Showing {count} videos matching your search.",
        "convert_to_text": "Convert to Text",
        "converting": "Converting audio to text...",
        "text_converted": "Audio converted to text successfully",
        // Subject translations
        "artificial_intelligence": "Artificial Intelligence",
        "ai_desc": "Machine learning, neural networks, and intelligent systems",
        "vlsi": "Very Large Scale Integration",
        "vlsi_desc": "Design and fabrication of integrated circuits",
        "renewable_energy": "Renewable Energy",
        "renewable_energy_desc": "Solar, wind, and sustainable energy technologies",
        "mathematics": "Mathematics",
        "math_desc": "Algebra, Calculus, Geometry and more",
        "physics": "Physics",
        "physics_desc": "Study of matter and energy",
        "chemistry": "Chemistry",
        "chemistry_desc": "Properties and behavior of matter",
        "biology": "Biology",
        "biology_desc": "Study of living organisms",
        "computer_science": "Computer Science",
        "cs_desc": "Programming and computational thinking",
        "data_science": "Data Science",
        "data_science_desc": "Big data analytics and visualization",
        "cybersecurity": "Cybersecurity",
        "cybersecurity_desc": "Protecting systems and networks from digital attacks"
      },
      ta: {
        "live_video": "நேரடி வீடியோ ஸ்ட்ரீம்",
        "upload_video": "வீடியோ பதிவேற்றம்",
        "upload_audio": "ஆடியோ பதிவேற்றம்",
        "labs": "ஆய்வகங்கள்",
        "subjects": "பாடங்கள்",
        "video_title": "வீடியோ தலைப்பு",
        "video_description": "வீடியோ விளக்கம்",
        "select_video": "வீடியோ கோப்பைத் தேர்ந்தெடுக்கவும்",
        "select_notes": "குறிப்புகள் கோப்பைத் தேர்ந்தெடுக்கவும் (விரும்பினால்)",
        "choose_file": "ஒரு வீடியோ கோப்பைத் தேர்வுசெய்யவும்",
        "choose_notes": "குறிப்புகள் கோப்பைத் தேர்வுசெய்யவும்",
        "uploaded_videos": "பதிவேற்றப்பட்ட வீடியோக்கள்",
        "uploaded_audio": "பதிவேற்றப்பட்ட ஆடியோ",
        "enter_video_title": "வீடியோ தலைப்பை உள்ளிடவும்",
        "enter_video_description": "வீடியோ விளக்கத்தை உள்ளிடவும்",
        "upload": "பதிவேற்றம்",
        "cancel": "ரத்து செய்",
        "copyright": "கேம்பஸ் மூன் © 2025",
        "delete": "அழி",
        "uploaded": "பதிவேற்றப்பட்டது",
        "search_subjects": "பாடங்களைத் தேடுங்கள்...",
        "search_subject_content": "இந்த பாடத்தில் தேடுங்கள்...",
        "back": "திரும்பு",
        "upload_videos": "வீடியோக்களைப் பதிவேற்று",
        "chatbot": "அரட்டை இயந்திரம்",
        "no_results": "உங்கள் தேடலுக்கு பொருந்தும் வீடியோக்கள் எதுவும் இல்லை.",
        "showing_results": "உங்கள் தேடலுக்கு பொருந்தும் {count} வீடியோக்களைக் காட்டுகிறது.",
        "convert_to_text": "உரையாக மாற்று",
        "converting": "ஆடியோவை உரையாக மாற்றுகிறது...",
        "text_converted": "ஆடியோ வெற்றிகரமாக உரையாக மாற்றப்பட்டது",
        // Subject translations
        "artificial_intelligence": "செயற்கை நுண்ணறிவு",
        "ai_desc": "இயந்திர கற்றல், நரம்பியல் நெட்வொர்க்குகள் மற்றும் நுண்ணறிவு அமைப்புகள்",
        "vlsi": "மிகப்பெரிய அளவிலான ஒருங்கிணைப்பு",
        "vlsi_desc": "ஒருங்கிணைந்த சுற்றுகளின் வடிவமைப்பு மற்றும் உற்பத்தி",
        "renewable_energy": "புதுப்பிக்கத்தக்க ஆற்றல்",
        "renewable_energy_desc": "சூரிய, காற்று மற்றும் நிலையான ஆற்றல் தொழில்நுட்பங்கள்",
        "mathematics": "கணிதம்",
        "math_desc": "இயற்கணிதம், கால்குலஸ், வடிவியல் மற்றும் பிற",
        "physics": "இயற்பியல்",
        "physics_desc": "பொருள் மற்றும் ஆற்றல் பற்றிய ஆய்வு",
        "chemistry": "வேதியியல்",
        "chemistry_desc": "பொருளின் பண்புகள் மற்றும் நடத்தை",
        "biology": "உயிரியல்",
        "biology_desc": "உயிரினங்களைப் பற்றிய ஆய்வு",
        "computer_science": "கணினி அறிவியல்",
        "cs_desc": "நிரலாக்கம் மற்றும் கணக்கீட்டு சிந்தனை",
        "data_science": "தரவு அறிவியல்",
        "data_science_desc": "பெரிய தரவு பகுப்பாய்வு மற்றும் காட்சிப்படுத்தல்",
        "cybersecurity": "சைபர் பாதுகாப்பு",
        "cybersecurity_desc": "டிஜிட்டல் தாக்குதல்களிலிருந்து அமைப்புகள் மற்றும் நெட்வொர்க்குகளைப் பாதுகாத்தல்"
      },
      hi: {
        "live_video": "लाइव वीडियो स्ट्रीम",
        "upload_video": "वीडियो अपलोड करें",
        "upload_audio": "ऑडियो अपलोड करें",
        "labs": "प्रयोगशालाएं",
        "subjects": "विषय",
        "video_title": "वीडियो शीर्षक",
        "video_description": "वीडियो विवरण",
        "select_video": "वीडियो फ़ाइल चुनें",
        "select_notes": "नोट्स फ़ाइल चुनें (वैकल्पिक)",
        "choose_file": "एक वीडियो फ़ाइल चुनें",
        "choose_notes": "एक नोट्स फ़ाइल चुनें",
        "uploaded_videos": "अपलोड किए गए वीडियो",
        "uploaded_audio": "अपलोड किया गया ऑडियो",
        "enter_video_title": "वीडियो शीर्षक दर्ज करें",
        "enter_video_description": "वीडियो विवरण दर्ज करें",
        "upload": "अपलोड करें",
        "cancel": "रद्द करें",
        "copyright": "कैंपस मून © 2025",
        "delete": "हटाएं",
        "uploaded": "अपलोड किया गया",
        "search_subjects": "विषय खोजें...",
        "search_subject_content": "इस विषय में खोजें...",
        "back": "वापस",
        "upload_videos": "वीडियो अपलोड करें",
        "chatbot": "चैटबॉट",
        "no_results": "आपकी खोज से मेल खाने वाला कोई वीडियो नहीं मिला।",
        "showing_results": "आपकी खोज से मेल खाने वाले {count} वीडियो दिखा रहे हैं।",
        "convert_to_text": "टेक्स्ट में बदलें",
        "converting": "ऑडियो को टेक्स्ट में बदल रहा है...",
        "text_converted": "ऑडियो को सफलतापूर्वक टेक्स्ट में बदल दिया गया",
        // Subject translations
        "artificial_intelligence": "कृत्रिम बुद्धिमत्ता",
        "ai_desc": "मशीन लर्निंग, न्यूरल नेटवर्क और इंटेलिजेंट सिस्टम",
        "vlsi": "वेरी लार्ज स्केल इंटीग्रेशन",
        "vlsi_desc": "एकीकृत परिपथों का डिजाइन और निर्माण",
        "renewable_energy": "नवीकरणीय ऊर्जा",
        "renewable_energy_desc": "सौर, पवन और टिकाऊ ऊर्जा प्रौद्योगिकियां",
        "mathematics": "गणित",
        "math_desc": "बीजगणित, कैलकुलस, ज्यामिति और अधिक",
        "physics": "भौतिक विज्ञान",
        "physics_desc": "पदार्थ और ऊर्जा का अध्ययन",
        "chemistry": "रसायन विज्ञान",
        "chemistry_desc": "पदार्थ के गुण और व्यवहार",
        "biology": "जीवविज्ञान",
        "biology_desc": "जीवित जीवों का अध्ययन",
        "computer_science": "कंप्यूटर विज्ञान",
        "cs_desc": "प्रोग्रामिंग और कम्प्यूटेशनल सोच",
        "data_science": "डाटा साइंस",
        "data_science_desc": "बिग डाटा एनालिटिक्स और विज़ुअलाइज़ेशन",
        "cybersecurity": "साइबर सुरक्षा",
        "cybersecurity_desc": "डिजिटल हमलों से सिस्टम और नेटवर्क की सुरक्षा"
      },
      rj: {
        "live_video": "लाइव वीडियो स्ट्रीम",
        "upload_video": "वीडियो अपलोड करो",
        "upload_audio": "ऑडियो अपलोड करो",
        "labs": "प्रयोगशालाएं",
        "subjects": "विषय",
        "video_title": "वीडियो शीर्षक",
        "video_description": "वीडियो विवरण",
        "select_video": "वीडियो फाइल चुनो",
        "select_notes": "नोट्स फाइल चुनो (वैकल्पिक)",
        "choose_file": "एक वीडियो फाइल चुनो",
        "choose_notes": "एक नोट्स फाइल चुनो",
        "uploaded_videos": "अपलोड किए गए वीडियो",
        "uploaded_audio": "अपलオड किया गया ऑडियो",
        "enter_video_title": "वीडियो शीर्षक भरो",
        "enter_video_description": "वीडियो विवरण भरो",
        "upload": "अपलोड करो",
        "cancel": "रद्द करो",
        "copyright": "कैंपस मून © 2025",
        "delete": "मिटावो",
        "uploaded": "अपलोड किया",
        "search_subjects": "विषय खोजो...",
        "search_subject_content": "इस विषय में खोजो...",
        "back": "वापस",
        "upload_videos": "वीडियो अपलोड करो",
        "chatbot": "चैटबॉट",
        "no_results": "आपकी खोज से मेल खाने वाला कोई वीडियो नहीं मिला।",
        "showing_results": "आपकी खोज से मेल खाने वाले {count} वीडियो दिखा रहे हैं।",
        "convert_to_text": "टेक्स्ट में बदलो",
        "converting": "ऑडियो को टेक्स्ट में बदल रहा है...",
        "text_converted": "ऑडियो को सफलतापूर्वक टेक्स्ट में बदल दिया गया",
        // Subject translations
        "artificial_intelligence": "कृत्रिम बुद्धिमत्ता",
        "ai_desc": "मशीन लर्निंग, न्यूरल नेटवर्क और इंटेलिजेंट सिस्टम",
        "vlsi": "वेरी लार्ज स्केल इंटीग्रेशन",
        "vlsi_desc": "एकीकृत परिपथों का डिजाइन और निर्माण",
        "renewable_energy": "नवीकरणीय ऊर्जा",
        "renewable_energy_desc": "सौर, पवन और टिकाऊ ऊर्जा प्रौद्योगिकियां",
        "mathematics": "गणित",
        "math_desc": "बीजगणित, कैलकुलस, ज्यामिति और बाकी",
        "physics": "भौतिक विज्ञान",
        "physics_desc": "पदार्थ और ऊर्जा की पढ़ाई",
        "chemistry": "रसायन विज्ञान",
        "chemistry_desc": "पदार्थ के गुण और बर्ताव",
        "biology": "जीवविज्ञान",
        "biology_desc": "जिंदा जीवों की पढ़ाई",
        "computer_science": "कंप्यूटर विज्ञान",
        "cs_desc": "प्रोग्रामिंग और कम्प्यूटेशनल सोच",
        "data_science": "डाटा साइंस",
        "data_science_desc": "बिग डाटा एनालिटिक्स और विज़ुअलाइज़ेशन",
        "cybersecurity": "साइबर सुरक्षा",
        "cybersecurity_desc": "डिजिटल हमलों से सिस्टम और नेटवर्क की सुरक्षा"
      }
    };

    // Language management
    let currentLanguage = 'en';
    let currentSubjectId = null; // Track current subject ID
    let allVideos = []; // Store all videos for the current subject
    let currentConvertedText = ''; // Store the converted text for downloading

    function setLanguage(lang) {
      if (!translations[lang]) return;
      
      currentLanguage = lang;
      localStorage.setItem('preferredLanguage', lang);
      document.getElementById('languageSelector').value = lang;
      
      // Update all translatable elements
      document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang][key]) {
          element.textContent = translations[lang][key];
        }
      });
      
      // Update all placeholder texts
      document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang][key]) {
          element.setAttribute('placeholder', translations[lang][key]);
        }
      });
      
      // Update subject cards
      updateSubjectCards();
    }

    function getPreferredLanguage() {
      // Check localStorage first
      const savedLang = localStorage.getItem('preferredLanguage');
      if (savedLang) return savedLang;
      
      // Then check browser language
      const browserLang = navigator.language || navigator.userLanguage;
      if (browserLang.startsWith('ta')) return 'ta';
      if (browserLang.startsWith('hi')) return 'hi';
      if (browserLang.startsWith('mr') || browserLang.startsWith('gu')) return 'rj'; // Approximate for Rajasthani
      
      return 'en'; // Default to English
    }

    // Show notification
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      // Hide notification after 3 seconds
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // Function to download text as a file
    function downloadTextAsFile(text, filename) {
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    // Expanded subject data with more subjects
    const subjects = [
      { id: 1, icon: 'fa-brain', nameKey: 'artificial_intelligence', descKey: 'ai_desc' },
      { id: 2, icon: 'fa-microchip', nameKey: 'vlsi', descKey: 'vlsi_desc' },
      { id: 3, icon: 'fa-solar-panel', nameKey: 'renewable_energy', descKey: 'renewable_energy_desc' },
      { id: 4, icon: 'fa-calculator', nameKey: 'mathematics', descKey: 'math_desc' },
      { id: 5, icon: 'fa-atom', nameKey: 'physics', descKey: 'physics_desc' },
      { id: 6, icon: 'fa-flask', nameKey: 'chemistry', descKey: 'chemistry_desc' },
      { id: 7, icon: 'fa-dna', nameKey: 'biology', descKey: 'biology_desc' },
      { id: 8, icon: 'fa-laptop-code', nameKey: 'computer_science', descKey: 'cs_desc' },
      { id: 9, icon: 'fa-chart-bar', nameKey: 'data_science', descKey: 'data_science_desc' },
      { id: 10, icon: 'fa-shield-alt', nameKey: 'cybersecurity', descKey: 'cybersecurity_desc' }
    ]

    function updateSubjectCards() {
      const subjectsGrid = document.getElementById('subjectsGrid');
      subjectsGrid.innerHTML = '';
      
      subjects.forEach(subject => {
        const card = document.createElement('div');
        card.className = 'subject-card';
        card.dataset.subjectId = subject.id;
        
        const subjectName = translations[currentLanguage] && translations[currentLanguage][subject.nameKey] 
          ? translations[currentLanguage][subject.nameKey] 
          : subject.nameKey;
          
        const subjectDesc = translations[currentLanguage] && translations[currentLanguage][subject.descKey] 
          ? translations[currentLanguage][subject.descKey] 
          : subject.descKey;
        
        card.innerHTML = `
          <div class="subject-icon"><i class="fas ${subject.icon}"></i></div>
          <h3 class="subject-title">${subjectName}</h3>
          <p class="subject-desc">${subjectDesc}</p>
        `;
        
        // Add click event to show subject page
        card.addEventListener('click', () => {
          showSubjectPage(subject.id);
        });
        
        subjectsGrid.appendChild(card);
      });
    }

    // Show subject page
    function showSubjectPage(subjectId) {
      currentSubjectId = subjectId; // Store the current subject ID
      const subject = subjects.find(s => s.id === subjectId);
      if (!subject) return;
      
      const subjectName = translations[currentLanguage] && translations[currentLanguage][subject.nameKey] 
        ? translations[currentLanguage][subject.nameKey] 
        : subject.nameKey;
      
      document.getElementById('subjectTitle').textContent = subjectName;
      document.getElementById('mainPage').style.display = 'none';
      document.getElementById('subjectPage').style.display = 'block';
      
      // Clear search when entering a new subject
      document.getElementById('subjectSearchInput').value = '';
      document.getElementById('clearSearchBtn').style.display = 'none';
      document.getElementById('searchResultsMessage').style.display = 'none';
      
      // Load videos for this subject
      loadVideos();
      
      // Load audio files for this subject
      loadAudioFiles();
    }

    // Show main page
    function showMainPage() {
      document.getElementById('subjectPage').style.display = 'none';
      document.getElementById('mainPage').style.display = 'block';
    }

    // Load videos from the backend
    async function loadVideos() {
      try {
        // Include the current subject ID in the request
        const response = await fetch(`http://localhost:8080/videos?subjectId=${currentSubjectId}`);
        if (!response.ok) {
          throw new Error('Failed to load videos');
        }
        
        const videos = await response.json();
        allVideos = videos; // Store all videos for filtering
        displayVideos(allVideos); // Display all videos initially
      } catch (error) {
        console.error('Error loading videos:', error);
        // Show error message to user
        const videoGrid = document.getElementById('videoGrid');
        videoGrid.innerHTML = `<p style="text-align: center; color: rgba(255,255,255,0.7);">Failed to load videos. Please try again later.</p>`;
      }
    }

    // Load audio files from the backend
    async function loadAudioFiles() {
      try {
        const response = await fetch(`/list-audio?subjectId=${currentSubjectId}`);
        if (!response.ok) {
          throw new Error('Failed to load audio files');
        }
        
        const data = await response.text();
        const urls = data.trim().split("\n").filter(url => url.length > 0);
        
        const audioList = document.getElementById('audioList');
        audioList.innerHTML = '';
        
        if (urls.length === 0) {
          audioList.innerHTML = "<p style='text-align: center; color: rgba(255,255,255,0.7);'>No audio files uploaded yet.</p>";
          return;
        }
        
        urls.forEach(url => {
          const audioItem = document.createElement('div');
          audioItem.className = 'audio-item';
          
          const audio = document.createElement('audio');
          audio.controls = true;
          audio.src = url;
          
          // Create action buttons container
          const audioActions = document.createElement('div');
          audioActions.className = 'audio-actions';
          
          // Convert to Text button
          const convertTextBtn = document.createElement('button');
          convertTextBtn.className = 'convert-text-btn';
          convertTextBtn.innerHTML = `<i class='fas fa-file-alt'></i> ${translations[currentLanguage].convert_to_text || 'Convert to Text'}`;
          convertTextBtn.addEventListener('click', () => convertAudioToText(url));
          
          // Add button to actions container
          audioActions.appendChild(convertTextBtn);
          
          audioItem.appendChild(audio);
          audioItem.appendChild(audioActions);
          
          audioList.appendChild(audioItem);
        });
      } catch (error) {
        console.error('Error loading audio files:', error);
        const audioList = document.getElementById('audioList');
        audioList.innerHTML = "<p style='text-align: center; color: rgba(255,255,255,0.7);'>Failed to load audio files. Please try again later.</p>";
      }
    }

    // Convert audio to text
    async function convertAudioToText(audioUrl) {
      showNotification(translations[currentLanguage].converting || 'Converting audio to text...');
      
      try {
        // Create form data with the audio URL
        const formData = new FormData();
        formData.append('fileUrl', audioUrl);
        formData.append('subjectId', currentSubjectId);
        
        // Send request to backend for conversion
        const response = await fetch('/convert-to-text', {
          method: 'POST',
          body: formData
        });
        
        if (!response.ok) {
          throw new Error('Conversion failed');
        }
        
        const result = await response.json();
        
        // Store the converted text for downloading
        currentConvertedText = result.text;
        
        // Display the text in a modal
        const textModal = document.getElementById('textModal');
        const convertedTextDiv = document.getElementById('convertedText');
        convertedTextDiv.innerHTML = `<p>${currentConvertedText}</p>`;
        textModal.style.display = 'flex';
        
        // Automatically download the text file
        const filename = audioUrl.split('/').pop().split('.')[0] + '.txt';
        downloadTextAsFile(currentConvertedText, filename);
        
        showNotification(translations[currentLanguage].text_converted || 'Audio converted to text successfully');
      } catch (error) {
        console.error('Error converting audio to text:', error);
        showNotification('Failed to convert audio to text. Please try again.', 'error');
      }
    }

    // Display videos in the gallery
    function displayVideos(videos) {
      const videoGrid = document.getElementById('videoGrid');
      videoGrid.innerHTML = '';
      
      if (videos.length === 0) {
        videoGrid.innerHTML = `<p style="text-align: center; color: rgba(255,255,255,0.7);">No videos uploaded yet.</p>`;
        return;
      }
      
      videos.forEach(video => {
        const videoCard = document.createElement('div');
        videoCard.className = 'video-card';
        videoCard.dataset.videoId = video.id;
        videoCard.dataset.videoFilename = video.filename;
        
        // Add click event to the entire video card to redirect to watch page
        videoCard.addEventListener('click', function(e) {
          // Don't redirect if the delete button was clicked
          if (e.target.closest('.video-delete-btn')) {
            return;
          }
          // Redirect to watch page with video filename as parameter
          window.location.href = `http://localhost:8080/watch?filename=${encodeURIComponent(video.filename)}`;
        });
        
        videoCard.innerHTML = `
          <video class="video-thumbnail" preload="metadata">
            <source src="${video.url}" type="video/mp4">
          </video>
          <div class="video-info">
            <h3 class="video-title">${video.title}</h3>
            <p class="video-description">${video.description || 'No description available'}</p>
            <div class="video-actions">
              <button class="video-delete-btn" onclick="event.stopPropagation(); deleteVideo('${video.filename}', this)">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        
        videoGrid.appendChild(videoCard);
      });
    }

    // Filter videos based on search term
    function filterVideos(searchTerm) {
      if (!searchTerm) {
        // If search term is empty, show all videos
        displayVideos(allVideos);
        return;
      }
      
      const term = searchTerm.toLowerCase();
      const filteredVideos = allVideos.filter(video => {
        const title = video.title ? video.title.toLowerCase() : '';
        const description = video.description ? video.description.toLowerCase() : '';
        return title.includes(term) || description.includes(term);
      });
      
      displayVideos(filteredVideos);
      
      // Show search results message
      const resultsMessage = document.getElementById('searchResultsMessage');
      resultsMessage.style.display = 'block';
      
      if (filteredVideos.length === 0) {
        resultsMessage.textContent = translations[currentLanguage].no_results || "No videos found matching your search.";
      } else {
        const message = translations[currentLanguage].showing_results || "Showing {count} videos matching your search.";
        resultsMessage.textContent = message.replace('{count}', filteredVideos.length);
      }
    }

    // Delete video
    async function deleteVideo(filename, buttonElement) {
      if (!confirm('Are you sure you want to delete this video?')) {
        return;
      }
      
      try {
        const response = await fetch('http://localhost:8080/delete', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ 
            filename: filename,
            subjectId: currentSubjectId // Include subject ID in delete request
          })
        });
        
        if (!response.ok) {
          throw new Error('Failed to delete video');
        }
        
        // Remove the video card from the UI
        const videoCard = buttonElement.closest('.video-card');
        videoCard.remove();
        
        // Also remove from allVideos array
        allVideos = allVideos.filter(video => video.filename !== filename);
        
        // If there's an active search, re-apply the filter
        const searchTerm = document.getElementById('subjectSearchInput').value;
        if (searchTerm) {
          filterVideos(searchTerm);
        }
        
        // Show success message
        showNotification('Video deleted successfully');
      } catch (error) {
        console.error('Error deleting video:', error);
        showNotification('Failed to delete video. Please try again.', 'error');
      }
    }

    // Initialize language and subjects
    document.addEventListener('DOMContentLoaded', function() {
      const preferredLang = getPreferredLanguage();
      setLanguage(preferredLang);
      
      // Set up language selector event
      document.getElementById('languageSelector').addEventListener('change', function() {
        setLanguage(this.value);
      });
      
      // Set up back button
      document.getElementById('backBtn').addEventListener('click', showMainPage);
      
      // Set up search functionality for subjects
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('keyup', function() {
        const searchTerm = this.value.toLowerCase();
        const subjectCards = document.querySelectorAll('.subject-card');
        
        subjectCards.forEach(card => {
          const title = card.querySelector('.subject-title').textContent.toLowerCase();
          const description = card.querySelector('.subject-desc').textContent.toLowerCase();
          
          if (title.includes(searchTerm) || description.includes(searchTerm)) {
            card.style.display = 'flex';
          } else {
            card.style.display = 'none';
          }
        });
      });
      
      // Set up subject page search functionality
      const subjectSearchInput = document.getElementById('subjectSearchInput');
      const subjectSearchBtn = document.getElementById('subjectSearchBtn');
      const clearSearchBtn = document.getElementById('clearSearchBtn');
      
      function performSubjectSearch() {
        const searchTerm = subjectSearchInput.value.trim();
        
        // Filter videos
        filterVideos(searchTerm);
        
        // Show/hide clear button based on search term
        if (searchTerm) {
          clearSearchBtn.style.display = 'inline-block';
        } else {
          clearSearchBtn.style.display = 'none';
        }
      }
      
      subjectSearchInput.addEventListener('keyup', function(event) {
        if (event.key === 'Enter') {
          performSubjectSearch();
        }
      });
      
      subjectSearchBtn.addEventListener('click', performSubjectSearch);
      
      // Clear search functionality
      clearSearchBtn.addEventListener('click', function() {
        subjectSearchInput.value = '';
        clearSearchBtn.style.display = 'none';
        document.getElementById('searchResultsMessage').style.display = 'none';
        displayVideos(allVideos);
      });
      
      // Set up upload modal
      const uploadModal = document.getElementById('uploadModal');
      const uploadBtn = document.getElementById('uploadBtn');
      const closeModal = document.getElementById('closeModal');
      const cancelUpload = document.getElementById('cancelUpload');
      
      uploadBtn.addEventListener('click', function() {
        // Set the current subject ID in the hidden form field
        document.getElementById('subjectId').value = currentSubjectId;
        uploadModal.style.display = 'flex';
      });
      
      closeModal.addEventListener('click', function() {
        uploadModal.style.display = 'none';
        resetUploadForm();
      });
      
      cancelUpload.addEventListener('click', function() {
        uploadModal.style.display = 'none';
        resetUploadForm();
      });
      
      // Set up file input labels for video upload
      const videoFileInput = document.getElementById('videoFile');
      const notesFileInput = document.getElementById('notesFile');
      
      videoFileInput.addEventListener('change', function() {
        const fileName = this.files[0]?.name || 'Choose a video file';
        document.getElementById('videoFileLabel').textContent = fileName;
      });
      
      notesFileInput.addEventListener('change', function() {
        const fileName = this.files[0]?.name || 'Choose a notes file';
        document.getElementById('notesFileLabel').textContent = fileName;
      });
      
      // Set up upload form submission
      const uploadForm = document.getElementById('uploadForm');
      uploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(uploadForm);
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        
        // Show progress bar
        progressContainer.style.display = 'block';
        progressBar.style.width = '0%';
        
        try {
          const response = await fetch('http://localhost:8080/upload', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            throw new Error('Upload failed');
          }
          
          const result = await response.json();
          
          // Update progress bar to 100%
          progressBar.style.width = '100%';
          
          // Close modal and reset form
          setTimeout(() => {
            uploadModal.style.display = 'none';
            resetUploadForm();
            
            // Reload videos to show the newly uploaded video
            loadVideos();
            
            // Show success message
            showNotification('Video uploaded successfully!');
          }, 1000);
        } catch (error) {
          console.error('Error uploading video:', error);
          showNotification('Failed to upload video. Please try again.', 'error');
          progressContainer.style.display = 'none';
        }
      });
      
      // Set up audio upload form submission
      const audioUploadForm = document.getElementById('audioUploadForm');
      audioUploadForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(audioUploadForm);
        
        try {
          const response = await fetch('/upload-audio', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            throw new Error('Upload failed');
          }
          
          const result = await response.text();
          
          // Show success message
          showNotification(result);
          
          // Reload audio list
          loadAudioFiles();
        } catch (error) {
          console.error('Error uploading audio:', error);
          showNotification('Upload failed: ' + error.message, 'error');
        }
      });
      
      // Set up refresh audio list button
      document.getElementById('refreshAudioList').addEventListener('click', loadAudioFiles);
      
      // Set up chatbot button
      document.getElementById('chatbotBtn').addEventListener('click', function() {
        showNotification('Chatbot would open here');
      });
      
      // Set up text modal close buttons
      const textModal = document.getElementById('textModal');
      const closeTextModal = document.getElementById('closeTextModal');
      const closeTextModalBtn = document.getElementById('closeTextModalBtn');
      const downloadTextBtn = document.getElementById('downloadTextBtn');
      
      closeTextModal.addEventListener('click', function() {
        textModal.style.display = 'none';
      });
      
      closeTextModalBtn.addEventListener('click', function() {
        textModal.style.display = 'none';
      });
      
      // Set up download text button
      downloadTextBtn.addEventListener('click', function() {
        if (currentConvertedText) {
          downloadTextAsFile(currentConvertedText, 'converted-text.txt');
        }
      });
    });

    // Reset upload form
    function resetUploadForm() {
      document.getElementById('uploadForm').reset();
      document.getElementById('videoFileLabel').textContent = 'Choose a video file';
      document.getElementById('notesFileLabel').textContent = 'Choose a notes file';
      document.getElementById('progressContainer').style.display = 'none';
      document.getElementById('progressBar').style.width = '0%';
    }
  </script>
</body>
</html>